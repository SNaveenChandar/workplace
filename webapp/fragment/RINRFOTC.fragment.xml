<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:sfb="sap.ui.comp.smartfilterbar"
    xmlns:smartTable="sap.ui.comp.smarttable"
    xmlns:sv="sap.ui.comp.smartvariants"
    xmlns:mc="sap.suite.ui.microchart"
    xmlns:table="sap.ui.table"
    xmlns:smartVariantManagement="sap.ui.comp.smartvariants"
    xmlns:sf="sap.ui.comp.smartfield"
>
    <f:DynamicPage
        id="idOTCDynamicPage"
        fitContent="true"
        toggleHeaderOnTitleClick="true"
        headerPinned="true"
    >
        <f:header>
            <f:DynamicPageHeader>

                <sfb:SmartFilterBar
                    id="idOTCSmartFilterBar"
                    entitySet="WorkplaceCreditOTCView"
                    persistencyKey="OTCSmartFilterPKey"
                    initialized="onFilterInitialized"
                >
                    <sfb:controlConfiguration>
                    <sfb:ControlConfiguration
                            key="subObjectScenario"
                            label="{i18n>renewableObject}"
                            visibleInAdvancedArea="true"
                        >
                            <sfb:customControl>
                                <MultiComboBox
                                    id="idRINSubObjectScenerio"
                                    selectedKeys="RFS2_RIN_RF"
                                    showSecondaryValues="true"
                                    
                                >
                                    <core:ListItem
                                        key="RFS2_RIN_RF"
                                        text="RIN RF Credit"
                                    />
                                     <core:ListItem
                                        key="RFS2_MADJ_RIN"
                                        text="Manual adjustment RF RIN"
                                    />
                                     <core:ListItem
                                        key="RFS2_RIN_OTC"
                                        text="RIN OTC Credit"
                                    />
                                </MultiComboBox>
                            </sfb:customControl>
                        </sfb:ControlConfiguration>
                        <sfb:ControlConfiguration
                            key="documentDate"
                            label="{i18n>documentDate}"
                            controlType="date"
                        >
                            <sfb:customControl>
                                <DateRangeSelection
                                    id="idOTCDocumentRangeSelection"
                                    displayFormat="MM/dd/yyyy"
                                />
                            </sfb:customControl>
                        </sfb:ControlConfiguration>
                        <sfb:ControlConfiguration
                            key="vintageYear"
                            label="{i18n>vintageYear}"
                        >
                            <sfb:customControl>
                                <DateRangeSelection
                                    id="idOTCVintageYear"
                                    displayFormat="yyyy"
                                />
                            </sfb:customControl>
                        </sfb:ControlConfiguration>
                        <sfb:ControlConfiguration
                            key="renewablesDocumentComplianceYear"
                            label="{i18n>complianceYear}"
                            
                        >
                            <sfb:customControl>
                                <DateRangeSelection
                                    id="idOTCComplianceYear"
                                    displayFormat="yyyy"
                                />
                            </sfb:customControl>
                        </sfb:ControlConfiguration>
                         <sfb:ControlConfiguration
                            key="reconcilliationGroupID"
                            label="{i18n>matchStatus}"
                            visibleInAdvancedArea="true"
                        >
                            <sfb:customControl>
                                <ComboBox
                                    id="idMatchUnMatch"
                                    selectedKey="All">
                                    <core:ListItem
                                        key="All"
                                        text="{i18n>all}"
                                    />
                                     <core:ListItem
                                        key="NE_and"
                                        text="{i18n>matched}"
                                    />
                                     <core:ListItem
                                        key="EQ_or"
                                        text="{i18n>unmatched}"
                                    />
                                
                                </ComboBox>
                            </sfb:customControl>
                        </sfb:ControlConfiguration>
                    </sfb:controlConfiguration>
                </sfb:SmartFilterBar>
                <FlexBox
                    id="idOTCVisualFilter"
                    width="20rem"
                    height="10rem"
                    alignItems="Stretch"
                    justifyContent="SpaceBetween"
                    visible="false"
                >
                    <items>
                     <Label
                            text="{i18n>byObjectType}"
                            design="Bold"
                        />
                        <mc:InteractiveDonutChart
                            selectionChanged="onOTCSelectionChanged($event,'objectType')"
                            displayedSegments="4"
                            segments="{/MaintainWorkplaceAggregationByObjectTypeView}"
                        >
                            <mc:segments>
                                <mc:InteractiveDonutChartSegment
                                    label="{objectType}"
                                    value="{= parseFloat(${TotalRegQuantityByObjectType}) }"
                                    displayedValue="{TotalRegQuantityByObjectType}"
                                />
                            </mc:segments>
                        </mc:InteractiveDonutChart>
                        <!-- Credit:D-code -->
                        <Label
                            text="{i18n>byDcode}"
                            design="Bold"
                            class="sapUiMediumMarginBegin"
                        />
                        <mc:InteractiveDonutChart
                            selectionChanged="onOTCSelectionChanged($event,'dcode')"
                            displayedSegments="4"
                            segments="{/MaintainWorkplaceAggregationByDcodeView}"
                        >
                            <mc:segments>
                                <mc:InteractiveDonutChartSegment
                                    label="{dcodeDesc}"
                                    value="{= parseFloat(${TotalRegQuantityByDcode}) }"
                                    displayedValue="{TotalRegQuantityByDcode}"
                                />
                            </mc:segments>
                        </mc:InteractiveDonutChart>
                        <!-- Credit: Status ( posted vs pending) -->
                        <Label
                            text="{i18n>byStatus}"
                            design="Bold"
                            class="sapUiMediumMarginBegin"
                        />
                        <mc:InteractiveDonutChart
                            selectionChanged="onOTCSelectionChanged($event,'processingStatus')"
                            displayedSegments="4"
                            segments="{/MaintainWorkplaceAggregationByStatusView}"
                        >
                            <mc:segments>
                                <mc:InteractiveDonutChartSegment
                                    label="{objectStatusDesc}"
                                    value="{= parseFloat(${TotalRegQuantityByStatus}) }"
                                    displayedValue="{TotalRegQuantityByStatus}"
                                />
                            </mc:segments>
                        </mc:InteractiveDonutChart>
                    </items>
                </FlexBox>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <smartTable:SmartTable
                id="idOTCSmartTable"
                entitySet="WorkplaceCreditOTCView"
                smartFilterId="idOTCSmartFilterBar"
                tableType="Table"
                enableAutoColumnWidth="true"
                useTablePersonalisation="true"
                showRowCount="true"
                header="{i18n>renewableCredit}"
                beforeRebindTable="onOTCBeforeRebindTable"
                enableAutoBinding="true"
                ignoreFromPersonalisation="subObjectScenarioDesc,regulationTypeDesc,objectTypeDesc,TransmissionStatusDesc,objectStatusDesc,transactionTypeDesc,dcodeDesc
                ,reasonCodeDesc,regulationCategoryDesc,objectCategoryDesc,fuelCategoryDesc,businessPartnerDesc,qapCertifiedDesc,destinationOrgMaterialNumberDes,sourceOrgMaterialNumberDesc,regulationLogisticsMaterialNumberDesc"
            >
                <smartTable:customToolbar>
                    <OverflowToolbar>
                        <ToolbarSpacer />
                        <ToolbarSeparator />
                        <Button
                            id="idOTCPostInventory"
                            text="{i18n>postInventory}"
                            type="Emphasized"
                            press="onPostInventory('idOTCSmartTable')"
                        />
                        <Button
                            id="idOTCExecute"
                            text="{i18n>OTCExecute}"
                            type="Emphasized"
                            press="onOTCExecute"
                        />
                        <Button
                            id="idOTCCancel"
                            text="{i18n>cancel}"
                            type="Emphasized"
                            press="onOTCCancel"
                        />
                        <Button
                            id="idOTCMatch"
                            text="{i18n>match}"
                            type="Emphasized"
                            press="onOTCMatch"
                        />
                        <Button
                            id="idOTCDisplayLogs"
                            text="{i18n>displayLogs}"
                            type="Emphasized"
                            press="onDisplayLogs('idOTCTable')"
                        />
                        <Button
                            id="idOTCCopyManualAdj"
                            text="{i18n>copyManualAdj}"
                            type="Emphasized"
                        />
                    </OverflowToolbar>
                </smartTable:customToolbar>

                <table:Table
                    id="idOTCTable"
                    selectionMode="Single"
                    selectionBehavior="Row"
                    alternateRowColors="true"
                    cellClick="onNavigateToObjectPage"
                    rowSelectionChange="onRowSelectionChange"
                    enableSelectAll="false"
                />
            </smartTable:SmartTable>
        </f:content>
    </f:DynamicPage>
</core:FragmentDefinition>
